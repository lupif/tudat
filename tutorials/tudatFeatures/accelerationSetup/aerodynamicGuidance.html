

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.2. Aerodynamic Guidance &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../../index.html"/>
        <link rel="up" title="4. Acceleration Set-Up" href="index.html"/>
        <link rel="next" title="4.3. Thrust Guidance" href="thrustModels.html"/>
        <link rel="prev" title="4.1. Implementation Framework of the Acceleration Settings" href="frameworkAcceleration.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Tutorials and Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../prerequiredKnowledge/index.html">Getting Started with Tudat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../applicationWalkthroughs/index.html">Application Walkthroughs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Tudat Libraries</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../astroTools/index.html">1. Basic Astrodynamics Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mathTools/index.html">2. Basic Mathematics Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../environmentSetup/index.html">3. Environment Set-up</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">4. Acceleration Set-Up</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="frameworkAcceleration.html">4.1. Implementation Framework of the Acceleration Settings</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">4.2. Aerodynamic Guidance</a></li>
<li class="toctree-l4"><a class="reference internal" href="thrustModels.html">4.3. Thrust Guidance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../propagationSetup/index.html">5. Simulator Set-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../estimationSetup/index.html">6. Estimation Set-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../otherLibraries/index.html">7. Other Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../optimizationTools/index.html">8. Optimization tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonInterface/index.html">JSON Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../matlabInterface/index.html">MATLAB Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../developerGuide/index.html">Developer Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Tutorials and Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">Tudat Libraries</a> &raquo;</li>
        
          <li><a href="index.html">4. Acceleration Set-Up</a> &raquo;</li>
        
      <li>4.2. Aerodynamic Guidance</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/tutorials/tudatFeatures/accelerationSetup/aerodynamicGuidance.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="aerodynamic-guidance">
<span id="tudatfeaturesaerodynamicguidance"></span><h1>4.2. Aerodynamic Guidance<a class="headerlink" href="#aerodynamic-guidance" title="Permalink to this headline">¶</a></h1>
<p>When including aerodynamics in the orbit propagation, it may often be desirable to modify the aerodynamic properties of the vehicle as a function of the current environment. This is the case for ascent and entry for instance. Also, control surface deflections may be needed to modify the vehicle’s behaviour. Both options are included in Tudat, and the interfaces are described below.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In applications were no aerodynamic guidance is used, the angle of attack, sideslip angle and bank angle are all implicitly set to zero.</p>
</div>
<div class="section" id="vehicle-orientation">
<h2>4.2.1. Vehicle orientation<a class="headerlink" href="#vehicle-orientation" title="Permalink to this headline">¶</a></h2>
<p>Although rotational motion can be propagated in Tudat (see <a class="reference internal" href="../propagationSetup/propagatorSettings.html#RotationalStatePropagatorSettings" title="RotationalStatePropagatorSettings"><code class="xref py py-class docutils literal"><span class="pre">RotationalStatePropagatorSettings</span></code></a>), sometime the user simply wants to impose this rotational motion on the vehicle.</p>
<p>For aerodynamics, the vehicle orientation is typically described by the angle of attack, angle of sideslip and bank angle, which is also the approach we take in Tudat. There is a single interface in Tudat through which the functions describing these angles are fed to the trajectory propagation:</p>
<dl class="class">
<dt id="AerodynamicAngleCalculator">
<em class="property">class </em><code class="descname">AerodynamicAngleCalculator</code><a class="headerlink" href="#AerodynamicAngleCalculator" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is used for the describing the angle of attack, angle of sideslip and bank angle of the vehicle. The&nbsp;<code class="docutils literal"><span class="pre">setOrientationAngleFunctions</span></code>&nbsp;member function of this&nbsp;class is used. However, there is a number of manners in which to use this function, either directly or indirectly, the preferred selection of course depending on your application. The options are:</p>
<blockquote>
<div><ul class="simple">
<li>Manual definitions of the three angles of a function of time (can also be used to set constant angles).</li>
<li>Pre-defined guidance laws (only angle-of-attack trim presently implemented).</li>
<li>A user-defined&nbsp;<a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicGuidance</span></code></a>&nbsp;class, which computes the current angles using any number of input/environment variables. This option is typically the preferred option for a realistic entry propagation.</li>
</ul>
</div></blockquote>
<p>Below, we will indicate how to use these three options for the example of the Apollo entry example. Currently, the following code is used in the example, defining a constant angle of attack of 30 degree, and 0 sideslip and bank angle:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getFlightConditions</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getAerodynamicAngleCalculator</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">setOrientationAngleFunctions</span><span class="p">(</span>
            <span class="n">boost</span><span class="o">::</span><span class="n">lambda</span><span class="o">::</span><span class="n">constant</span><span class="p">(</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">We stress that&nbsp;any&nbsp;definition of the aerodynamic guidance must be done after the acceleration models have been created (by <a class="reference internal" href="frameworkAcceleration.html#AccelerationSettings" title="AccelerationSettings"><code class="xref py py-class docutils literal"><span class="pre">AccelerationSettings</span></code></a>)(but before the trajectory is propagated).</p>
</div>
</dd></dl>

<div class="section" id="manual-angle-functions">
<h3>4.2.1.1. Manual angle functions<a class="headerlink" href="#manual-angle-functions" title="Permalink to this headline">¶</a></h3>
<p>To manually set the body orientation as constant angles, the&nbsp;<code class="docutils literal"><span class="pre">setOrientationAngleFunctions</span></code>&nbsp;function is called directly, as is done in the above example. Note that if you need a definition of aerodynamic angles that varies with time, a specific&nbsp;<a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicGuidance</span></code></a>&nbsp;derived class should be implemented or one of the predefined orientation functions should be used. In general, the manual definition of the angles is done as follows:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">constantAngleOfAttack</span> <span class="o">=</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">constantSideslipAngle</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">constantBankAngle</span> <span class="o">=</span> <span class="o">-</span><span class="mf">70.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>

<span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getFlightConditions</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getAerodynamicAngleCalculator</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">setOrientationAngleFunctions</span><span class="p">(</span>
            <span class="n">boost</span><span class="o">::</span><span class="n">lambda</span><span class="o">::</span><span class="n">constant</span><span class="p">(</span> <span class="n">constantAngleOfAttack</span> <span class="p">),</span> <span class="n">boost</span><span class="o">::</span><span class="n">lambda</span><span class="o">::</span><span class="n">constant</span><span class="p">(</span> <span class="n">constantSideslipAngle</span> <span class="p">),</span> <span class="n">boost</span><span class="o">::</span><span class="n">lambda</span><span class="o">::</span><span class="n">constant</span><span class="p">(</span> <span class="n">constantBankAngle</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>By using this code, the vehicle will fly at 30 degree angle of attack, 2 degree sideslip angle and -70 degree bank angle during the full propagation.</p>
</div>
<div class="section" id="predefined-guidance-law">
<h3>4.2.1.2. Predefined guidance law<a class="headerlink" href="#predefined-guidance-law" title="Permalink to this headline">¶</a></h3>
<p>Presently, only a single predefined guidance law is implemented in Tudat: imposing pitch-trim. When using this setting, the sideslip and bank angles are set to zero, while the angle of attack is chosen such that the pitch moment coefficient is exactly zero. It is set by using:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">TrimOrientationCalculator</span> <span class="o">&gt;</span> <span class="n">trimCalculator</span> <span class="o">=</span> <span class="n">setTrimmedConditions</span><span class="p">(</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>After calling this function, no additional action is needed from the user. In fact, using the following:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">setTrimmedConditions</span><span class="p">(</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>will work equally well. The&nbsp;<code class="xref py py-class docutils literal"><span class="pre">TrimOrientationCalculator</span></code>&nbsp;is returned by the function to keep the object through which the computations are performed available to the user.</p>
</div>
<div class="section" id="user-defined-aerodynamic-orientation">
<h3>4.2.1.3. User-defined aerodynamic orientation<a class="headerlink" href="#user-defined-aerodynamic-orientation" title="Permalink to this headline">¶</a></h3>
<p>For a general description of the vehicle orientation, a custom-defined function is typically required, to fit the needs to the mission/simulation under consideration. To facilitate this process, we have defined a virtual base class called&nbsp;<a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicGuidance</span></code></a>.</p>
<dl class="class">
<dt id="AerodynamicGuidance">
<em class="property">class </em><code class="descname">AerodynamicGuidance</code><a class="headerlink" href="#AerodynamicGuidance" title="Permalink to this definition">¶</a></dt>
<dd><p>Virtual base class used to facilitate user-defined derived guidance classes.</p>
</dd></dl>

<p>A user-defined derived class must be defined, through which the orientation is computed at each time step of the propagation. Below, there are several examples of how to implement such a guidance algorithm. In each case, the final binding to the propagation is done as follows:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">AerodynamicGuidance</span> <span class="o">&gt;</span> <span class="n">aerodynamicGuidance</span> <span class="o">=</span>  <span class="c1">// Create user-defined guidance object here</span>
<span class="n">setGuidanceAnglesFunctions</span><span class="p">(</span> <span class="n">aerodynamicGuidance</span><span class="p">,</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>An example of the computation of the three aerodynamic angles as a function of time alone can be done by using the following&nbsp;<a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicGuidance</span></code></a>&nbsp;derived class:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LinearTimeAerodynamicGuidance</span><span class="o">:</span> <span class="k">public</span> <span class="n">AerodynamicGuidance</span>
<span class="p">{</span>
    <span class="n">LinearTimeAerodynamicGuidance</span><span class="p">(</span>
        <span class="k">const</span> <span class="kt">double</span> <span class="n">angleOfAttackRate</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">sideslipAngleRate</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">bankAngleRate</span><span class="p">,</span>
            <span class="k">const</span> <span class="kt">double</span> <span class="n">referenceTime</span> <span class="p">)</span><span class="o">:</span>
                <span class="n">angleOfAttackRate_</span><span class="p">(</span> <span class="n">angleOfAttackRate</span> <span class="p">),</span> <span class="n">sideslipAngleRate_</span><span class="p">(</span> <span class="n">sideslipAngleRate</span> <span class="p">),</span> <span class="n">bankAngleRate_</span><span class="p">(</span> <span class="n">bankAngleRate</span> <span class="p">),</span>
                    <span class="n">referenceTime_</span><span class="p">(</span> <span class="n">referenceTime</span> <span class="p">){</span> <span class="p">}</span>

<span class="kt">void</span> <span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="n">angleOfAttackRate_</span> <span class="o">*</span> <span class="p">(</span> <span class="n">currentTime</span> <span class="o">-</span> <span class="n">referenceTime_</span> <span class="p">);</span>
    <span class="n">currentAngleOfSideslip_</span> <span class="o">=</span> <span class="n">sideslipAngleRate_</span> <span class="o">*</span> <span class="p">(</span> <span class="n">currentTime</span> <span class="o">-</span> <span class="n">referenceTime_</span> <span class="p">);</span>
    <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="n">bankAngleRate_</span> <span class="o">*</span> <span class="p">(</span> <span class="n">currentTime</span> <span class="o">-</span> <span class="n">referenceTime_</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span><span class="o">:</span>

    <span class="kt">double</span> <span class="n">angleOfAttackRate_</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">sideslipAngleRate_</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">bankAngleRate_</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">referenceTime_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Then, the guidance law can be created and set by:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">AerodynamicGuidance</span> <span class="o">&gt;</span> <span class="n">aerodynamicGuidance</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">LinearTimeAerodynamicGuidance</span> <span class="o">&gt;</span><span class="p">(</span>
    <span class="mf">1.0E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0E-6</span><span class="p">,</span> <span class="mf">1.0E-3</span><span class="p">,</span> <span class="mf">500.0</span> <span class="p">);</span>
<span class="n">setGuidanceAnglesFunctions</span><span class="p">(</span> <span class="n">aerodynamicGuidance</span><span class="p">,</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>This creates and sets aerodynamic angles that are zero at t=500 s, where the angles of attack, sideslip and bank change by 10&nbsp;-4, -2*10&nbsp;-6&nbsp;and 10&nbsp;-3&nbsp;rad/s. Recall that al units in Tudat are SI unless otherwise indicated. The key behind this implementation in the&nbsp;<a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicGuidance</span></code></a> derived class is the following:</p>
<blockquote>
<div><ul class="simple">
<li>A definition of a&nbsp;<code class="docutils literal"><span class="pre">void</span> <span class="pre">updateGuidance(</span> <span class="pre">const</span> <span class="pre">double</span> <span class="pre">currentTime</span> <span class="pre">)</span></code>&nbsp;function in the derived class, which is called every time step to compute the current angles as a function of time.</li>
<li>The calculation of&nbsp;<code class="docutils literal"><span class="pre">currentAngleOfAttack_</span></code>,&nbsp;<code class="docutils literal"><span class="pre">currentAngleOfSideslip_</span></code>&nbsp;and&nbsp;<code class="docutils literal"><span class="pre">currentBankAngle_</span></code>&nbsp;in this function. Whichever values these variables are set to in the&nbsp;<code class="docutils literal"><span class="pre">updateGuidance</span></code>&nbsp;function are the values that will be used during the current time step.</li>
</ul>
</div></blockquote>
<p>The example of aerodynamic guidance given above is not very representative, of course. In general, you will want to define your body’s orientation as a function of its current state/environment, etc. To accomplish this, you can add the body map (or any its contents) as member variables to your&nbsp;<a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicGuidance</span></code></a>&nbsp;derived class. In many cases, the required information will be stored in the&nbsp;<a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal"><span class="pre">FlightConditions</span></code></a>&nbsp;object.</p>
<dl class="class">
<dt id="FlightConditions">
<em class="property">class </em><code class="descname">FlightConditions</code><a class="headerlink" href="#FlightConditions" title="Permalink to this definition">¶</a></dt>
<dd><p>Class which stores data on altitude, density, airspeed, etc.</p>
</dd></dl>

<p>To compute orientation angles from these flight conditions:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FlightConditionsBasedAerodynamicGuidance</span><span class="o">:</span> <span class="k">public</span> <span class="n">AerodynamicGuidance</span>
<span class="p">{</span>
    <span class="n">FlightConditionsBasedAerodynamicGuidance</span><span class="p">(</span>
            <span class="k">const</span> <span class="n">NamedBodyMap</span><span class="o">&amp;</span> <span class="n">bodyMap</span><span class="p">,</span>
            <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">vehicleName</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">vehicleFlightConditions_</span> <span class="o">=</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="n">vehicleName</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getFlightConditions</span><span class="p">(</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">);</span>

<span class="k">private</span><span class="o">:</span>

    <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">FlightConditions</span> <span class="o">&gt;</span> <span class="n">vehicleFlightConditions_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>where the&nbsp;<code class="docutils literal"><span class="pre">updateGuidance</span></code>&nbsp;function is not defined directly in the <code class="docutils literal"><span class="pre">.h</span></code> file, but instead in the <code class="docutils literal"><span class="pre">.cpp</span></code> file. As an example, let’s consider the simplified (and still not particularly realistic) aerodynamic guidance where:</p>
<blockquote>
<div><ul class="simple">
<li>Angle of attack is 35 degrees is altitude is larger than 60 km, angle of attack is 5 degrees at 30 km, and changes linearly between these two values.</li>
<li>Sideslip angle is always zero.</li>
<li>Bank angle is 80 degrees if mach number is larger than 8.</li>
</ul>
</div></blockquote>
<p>The implementation of the&nbsp;<code class="docutils literal"><span class="pre">updateGuidance</span></code>&nbsp;functions in the <code class="docutils literal"><span class="pre">.cpp</span></code> file would then read:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">FlightConditionsBasedAerodynamicGuidance</span><span class="o">::</span><span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mf">60.0E3</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="mf">35.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">25.0E3</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">5.0</span> <span class="o">+</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="n">currentAngleOfSideslip_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentMachNumber</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="mf">80.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Although this guidance profile is still not very realistic for full numerical simulations, it does show the manner in which the interface is to be set up for a more realistic approach.</p>
</div>
<div class="section" id="using-the-environment-models">
<h3>4.2.1.4. Using the environment models<a class="headerlink" href="#using-the-environment-models" title="Permalink to this headline">¶</a></h3>
<p>In computing your aerodynamic guidance commands, you will likely need to use a number of physical quantities from your environment, as is the case with the example above, where the altitude is used. Below, a list is given with the way in which to retrieve some variables that are typical in aerodynamic guidance:</p>
<blockquote>
<div><ul class="simple">
<li><strong>Current conditions at a vehicle’s location w.r.t. a central central body:</strong> These are stored in an object of type&nbsp;<a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal"><span class="pre">FlightConditions</span></code></a>&nbsp;(stored in a&nbsp;<a class="reference internal" href="../environmentSetup/index.html#Body" title="Body"><code class="xref py py-class docutils literal"><span class="pre">Body</span></code></a>&nbsp;object; retrieved by using the&nbsp;<code class="docutils literal"><span class="pre">getFlightConditions</span></code>&nbsp;function). In the&nbsp;<a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal"><span class="pre">FlightConditions</span></code></a>&nbsp;class, you will see a number of functions called&nbsp;<code class="docutils literal"><span class="pre">getCurrent...</span></code>. When called from the&nbsp;<a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicGuidance</span></code></a>&nbsp;derived class, the current value of the associated quantity is returned (e.g.&nbsp;<code class="docutils literal"><span class="pre">getCurrentAltitude</span></code>&nbsp;returns altitude,&nbsp;<code class="docutils literal"><span class="pre">getCurrentAirspeed</span></code>&nbsp;returns airspeed,&nbsp;etc.).</li>
<li><strong>Aerodynamic coefficients:</strong> These often play a particularly important role in the aerodynamic guidance. Whereas the other dependent variables are computed before updating the angles of attack, sideslip and bank, the aerodynamic coefficients are computed&nbsp;as a function of these angles. Therefore, the ‘current aerodynamic coefficients’ cannot yet be retrieved from the environment when updating the guidance. However, if the angles on which the aerodynamic coefficients depend have already been locally computed (in <code class="docutils literal"><span class="pre">currentAngleOfAttack_</span></code>,&nbsp;etc.), they may be used for determination of subsequent angles. Below is an example of aerodynamic coefficients depending on angle of attack, angle of sideslip and Mach number and the bank angle determined as a function of aerodynamic coefficients. The following can then be used inside the&nbsp;<code class="docutils literal"><span class="pre">updateGuidance</span></code>&nbsp;function:</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="c1">// Define aerodynamic coefficient interface/flight conditions (typically retrieved from body map; may also be a member variable)</span>
<span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">AerodynamicCoefficientInterface</span> <span class="o">&gt;</span> <span class="n">coefficientInterface_</span> <span class="o">=</span> <span class="p">...</span>
<span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">FlightConditions</span> <span class="o">&gt;</span> <span class="n">flightConditions_</span> <span class="o">=</span> <span class="p">...</span>

<span class="c1">// Compute angles of attack and sideslip</span>
<span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="p">...</span>
<span class="n">currentAngleOfSideslip_</span> <span class="o">=</span> <span class="p">...</span>

<span class="c1">// Define input to aerodynamic coefficients: take care of order of input (this depends on how the coefficients are created)!</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="n">currentAerodynamicCoefficientsInput_</span><span class="p">;</span>
<span class="n">currentAerodynamicCoefficientsInput_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">currentAngleOfAttack_</span> <span class="p">);</span>
<span class="n">currentAerodynamicCoefficientsInput_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">currentAngleOfSideslip_</span> <span class="p">);</span>
<span class="n">currentAerodynamicCoefficientsInput_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">flightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentMachNumber</span><span class="p">(</span> <span class="p">)</span> <span class="p">);</span>

<span class="c1">// Update and retrieve current aerodynamic coefficients</span>
<span class="n">coefficientInterface_</span><span class="o">-&gt;</span><span class="n">updateCurrentCoefficients</span><span class="p">(</span> <span class="n">currentAerodynamicCoefficientsInput_</span> <span class="p">);</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span> <span class="n">currentAerodynamicCoefficients</span> <span class="o">=</span> <span class="n">coefficientInterface_</span><span class="o">-&gt;</span><span class="n">getCurrentForceCoefficients</span><span class="p">(</span> <span class="p">);</span>

<span class="c1">// Compute bank angle</span>
<span class="n">currentBankAngle_</span> <span class="o">=</span>  <span class="n">some</span> <span class="n">function</span> <span class="n">of</span> <span class="n">currentAerodynamicCoefficients</span>
</pre></div>
</div>
<p>Note that the physical meaning of the coefficients may differ, depending on how they are defined in <a class="reference internal" href="../environmentSetup/index.html#AerodynamicCoefficientSettings" title="AerodynamicCoefficientSettings"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicCoefficientSettings</span></code></a>: if they are defined in the aerodynamic frame (<code class="docutils literal"><span class="pre">C_D</span></code>, <code class="docutils literal"><span class="pre">C_S</span></code>, <code class="docutils literal"><span class="pre">C_L</span></code>)  this is how they are returned.</p>
<ul class="simple">
<li><strong>Current vehicle orientation angles:</strong> In particular, the angles used to define the spherical vehicle state: latitude, longitude, flight path angle and heading angle may be needed. These are retrieved from an object of type&nbsp;<a class="reference internal" href="#AerodynamicAngleCalculator" title="AerodynamicAngleCalculator"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicAngleCalculator</span></code></a>, which is retrieved from the&nbsp;<a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal"><span class="pre">FlightConditions</span></code></a>&nbsp;class with the&nbsp;<code class="docutils literal"><span class="pre">getAerodynamicAngleCalculator</span></code>&nbsp;function. The&nbsp;<a class="reference internal" href="#AerodynamicAngleCalculator" title="AerodynamicAngleCalculator"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicAngleCalculator</span></code></a>&nbsp;class in turn has a function&nbsp;<code class="docutils literal"><span class="pre">getAerodynamicAngle</span></code>, which takes a single argument: the type of angle that is to be returned. You can use any of the&nbsp;first four identifiers&nbsp;in the&nbsp;<code class="xref py py-class docutils literal"><span class="pre">AerodynamicsReferenceFrameAngles</span></code>. In the aerodynamic guidance,&nbsp;DO NOT&nbsp;use this function to retrieve the angle of attack, sideslip or bank. As an example, you can use:</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="c1">// Define aerodynamic coefficient interface/flight conditions (typically retrieved from body map; may also be a member variable)</span>
<span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">FlightConditions</span> <span class="o">&gt;</span> <span class="n">flightConditions_</span> <span class="o">=</span> <span class="p">...</span>
<span class="kt">double</span> <span class="n">currentFlightPathAngle</span> <span class="o">=</span> <span class="n">flightConditions_</span><span class="o">-&gt;</span><span class="n">getAerodynamicAngleCalculator</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getAerodynamicAngle</span><span class="p">(</span> <span class="n">reference_frames</span><span class="o">::</span><span class="n">flight_path_angle</span> <span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Body mass:</strong> The mass of the body at the current time is retrieved directly from the&nbsp;<a class="reference internal" href="../environmentSetup/index.html#Body" title="Body"><code class="xref py py-class docutils literal"><span class="pre">Body</span></code></a>&nbsp;object using the&nbsp;<code class="docutils literal"><span class="pre">getBodyMass(</span> <span class="pre">)</span></code>&nbsp;function.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="control-surface-deflections">
<h2>4.2.2. Control surface deflections<a class="headerlink" href="#control-surface-deflections" title="Permalink to this headline">¶</a></h2>
<p>For a realistic vehicle entry/ascent trajectory propagation, it will often be necessary to include control surface deflections in the numerical propagation. How to load/define the aerodynamic influence of control surfaces is discussed at the end of this page.</p>
<p>To use the control surface increments, the control surface deflections have to be set, either to a constant value before stating the propagation, or every time step by a user-defined guidance system. In each case, the control surface deflections are stored in a&nbsp;<code class="xref py py-class docutils literal"><span class="pre">VehicleSystems</span></code>&nbsp;object, which is a member of a&nbsp;<a class="reference internal" href="../environmentSetup/index.html#Body" title="Body"><code class="xref py py-class docutils literal"><span class="pre">Body</span></code></a>&nbsp;object. The vehicle systems represent a collection of all physical (hardware) properties of a vehicle including the control surface deflections and properties. Presently, the only quantities that are stored for the control surfaces are the current deflection.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If your application requires more extensive functionality, please open an issue requesting this feature on Github).</p>
</div>
<p>In either case, a&nbsp;<code class="xref py py-class docutils literal"><span class="pre">VehicleSystems</span></code>&nbsp;object must be created and stored in the associated&nbsp;<a class="reference internal" href="../environmentSetup/index.html#Body" title="Body"><code class="xref py py-class docutils literal"><span class="pre">Body</span></code></a>&nbsp;object:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">system_models</span><span class="o">::</span><span class="n">VehicleSystems</span> <span class="o">&gt;</span> <span class="n">systemsModels</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">system_models</span><span class="o">::</span><span class="n">VehicleSystems</span> <span class="o">&gt;</span><span class="p">(</span> <span class="p">);</span>
<span class="n">bodyMap</span><span class="p">[</span> <span class="s">&quot;Vehicle&quot;</span> <span class="p">]</span><span class="o">-&gt;</span><span class="n">setVehicleSystems</span><span class="p">(</span> <span class="n">systemsModels</span> <span class="p">);</span>
</pre></div>
</div>
<p>The control surface deflections are then set by:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">elevonDeflection</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">controlSurfaceId</span> <span class="o">=</span> <span class="s">&quot;Elevon&quot;</span><span class="p">;</span>
<span class="n">apolloSystems</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="n">controlSurfaceId</span><span class="p">,</span> <span class="n">elevonDeflection</span> <span class="p">);</span>
</pre></div>
</div>
<p>Note that the deflections of multiple control surfaces can be set in exactly the same manner as follows:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">apolloSystems</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Elevon&quot;</span><span class="p">,</span> <span class="mf">0.1</span> <span class="p">);</span>
<span class="n">apolloSystems</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Aileron1&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span> <span class="p">);</span>
<span class="n">apolloSystems</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Aileron2&quot;</span><span class="p">,</span> <span class="mf">0.15</span> <span class="p">);</span>
</pre></div>
</div>
<p>When only using the above, the control surfaces are set to a costant deflection throughout the propagation. This may not be very realistic but can be useful for preliminary analysis.</p>
<p>In general, however, you will want to determine the control surface deflections as a function of your current state, time,&nbsp;etc.&nbsp;The best way to achieve this is by incorporating the control surface deflections into the aerodynamic guidance, in particular into your specific derived class of&nbsp;<a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicGuidance</span></code></a>&nbsp;(see above). As an example, consider the following:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FlightConditionsBasedAerodynamicExtendedGuidance</span><span class="o">:</span> <span class="k">public</span> <span class="n">AerodynamicGuidance</span>
<span class="p">{</span>
    <span class="n">FlightConditionsBasedAerodynamicExtendedGuidance</span><span class="p">(</span>
            <span class="k">const</span> <span class="n">NamedBodyMap</span><span class="o">&amp;</span> <span class="n">bodyMap</span><span class="p">,</span>
            <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">vehicleName</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">vehicleFlightConditions_</span> <span class="o">=</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="n">vehicleName</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getFlightConditions</span><span class="p">(</span> <span class="p">);</span>
        <span class="n">vehicleSystems_</span> <span class="o">=</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="n">vehicleName</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getVehicleSystems</span><span class="p">(</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">);</span>

<span class="k">private</span><span class="o">:</span>

    <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">FlightConditions</span> <span class="o">&gt;</span> <span class="n">vehicleFlightConditions_</span><span class="p">;</span>

    <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">system_models</span><span class="o">::</span><span class="n">VehicleSystems</span> <span class="o">&gt;</span> <span class="n">vehicleSystems_</span><span class="p">;</span>

<span class="p">};</span>
</pre></div>
</div>
<p>Compared to the&nbsp;<code class="xref py py-class docutils literal"><span class="pre">FlightConditionsBasedAerodynamicGuidance</span></code>&nbsp;class defined above, you can see that it has been extended with the ability to access the&nbsp;<code class="xref py py-class docutils literal"><span class="pre">VehicleSystems</span></code>&nbsp;member of the associated body. In the implementation of the&nbsp;<code class="docutils literal"><span class="pre">updateGuidance</span></code>&nbsp;function, the control surface deflections may now be incorporated as follows:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">FlightConditionsBasedAerodynamicExtendedGuidance</span><span class="o">::</span><span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mf">60.0E3</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="mf">35.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">25.0E3</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">5.0</span> <span class="o">+</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="n">currentAngleOfSideslip_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentMachNumber</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="mf">80.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="n">elevonDeflection</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">aileron1Deflection</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">7.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">aileron2Deflection</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">7.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>

    <span class="n">vehicleSystems_</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Elevon&quot;</span><span class="p">,</span> <span class="n">elevonDeflection</span> <span class="p">);</span>
    <span class="n">vehicleSystems_</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Aileron1&quot;</span><span class="p">,</span> <span class="n">aileron1Deflection</span> <span class="p">);</span>
    <span class="n">vehicleSystems_</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Aileron2&quot;</span><span class="p">,</span> <span class="n">aileron2Deflection</span> <span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<p>As with the previous examples, the values to which the control surface deflections are set are quite arbitrary and not based on any particularly realistic model. They are defined for illustration purposes only. A key difference between the manner in which the aerodynamic angles and the control surface deflections are handled by the guidance object is that the angles are&nbsp;computed&nbsp;but not&nbsp;set&nbsp;by the object (the angles are retrieved and set in the body model by the&nbsp;<a class="reference internal" href="#AerodynamicAngleCalculator" title="AerodynamicAngleCalculator"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicAngleCalculator</span></code></a>). The control surface deflections on the other hand are both&nbsp;computed and set&nbsp;by the guidance object.</p>
</div>
<div class="section" id="reading-aerodynamic-coefficients-from-files">
<span id="tudatfeaturesaerodynamicguidancereadingaerodynamiccoefficients"></span><h2>4.2.3. Reading aerodynamic coefficients from Files<a class="headerlink" href="#reading-aerodynamic-coefficients-from-files" title="Permalink to this headline">¶</a></h2>
<p>For many simulations/analyses involving atmospheric flight, the aerodynamic coefficients will be provided in tabulated form. If put into the correct file format, these files can be read into Tudat used during the orbit propagation. By specifying the physical meaning of the independent variables of the aerodynamic coefficients, no action on the side of the user is required to update the aerodynamic coefficients to their correct values during propagation. Here, we give an overview and some examples on how to load aerodynamic coefficients from a file.</p>
<div class="section" id="loading-the-coefficient-settings">
<h3>4.2.3.1. Loading the coefficient settings<a class="headerlink" href="#loading-the-coefficient-settings" title="Permalink to this headline">¶</a></h3>
<p>As a reminder, aerodynamic coefficients are created in Tudat by creating an object of type&nbsp;<a class="reference internal" href="../environmentSetup/index.html#AerodynamicCoefficientSettings" title="AerodynamicCoefficientSettings"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicCoefficientSettings</span></code></a>:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">AerodynamicCoefficientSettings</span> <span class="o">&gt;</span> <span class="n">aerodynamicCoefficientSettings</span> <span class="o">=</span> <span class="p">.....</span>
<span class="n">bodyMap</span><span class="p">[</span> <span class="s">&quot;VehicleName&quot;</span> <span class="p">]</span><span class="o">-&gt;</span><span class="n">setAerodynamicCoefficientInterface</span><span class="p">(</span>
                    <span class="n">createAerodynamicCoefficientInterface</span><span class="p">(</span> <span class="n">aerodynamicCoefficientSettings</span><span class="p">,</span> <span class="s">&quot;VehicleName&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>To create an&nbsp;<a class="reference internal" href="../environmentSetup/index.html#AerodynamicCoefficientSettings" title="AerodynamicCoefficientSettings"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicCoefficientSettings</span></code></a>&nbsp;object from data in files, we provide two functions named&nbsp;<code class="docutils literal"><span class="pre">readTabulatedAerodynamicCoefficientsFromFiles</span></code>&nbsp;(in <code class="docutils literal"><span class="pre">createFlightConditions.h</span></code>). For one of the functions, only force coefficients are loaded (with moment coefficients set to zero at all times). The other function allows both force and moment coefficients to be loaded.</p>
<p>For the situation where only force coefficients are considered, several pieces information are needed:</p>
<blockquote>
<div><ul class="simple">
<li>A list of files for any of the three aerodynamic coefficients (e.g. C<sub>D</sub>, C<sub>S</sub>, C<sub>L</sub>&nbsp;or C<sub>X</sub>, C<sub>Y</sub>, C<sub>Z</sub>). Note that the behaviour of each coefficient must be provided in a&nbsp;separate file. Note that not every coefficient needs to be defined. If a file is not provided for one of the coefficients, as will often be the case for C<sub>S</sub>, zeros are assumed at all points in the propagation.</li>
<li>The physical meaning of each of the independent variables of the coefficients.</li>
<li>The reference area for the aerodynamics. This is&nbsp;not&nbsp;read from the file and must be provided as an input to the function.</li>
<li>Two booleans denoting the orientation and direction of the aerodynamic coefficients. For instance C<sub>D</sub>, C<sub>S</sub>, C<sub>L</sub>&nbsp;denote the strength of the aerodynamic force in the aerodynamic reference frame, in a direction opposite to the axes of that frame. The C<sub>X</sub>, C<sub>Y</sub>, C<sub>Z</sub>&nbsp;coefficients, on the other hand, are defined in the body-fixed frame.</li>
</ul>
</div></blockquote>
<p>As an example, the following can be used to create&nbsp;<a class="reference internal" href="../environmentSetup/index.html#AerodynamicCoefficientSettings" title="AerodynamicCoefficientSettings"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicCoefficientSettings</span></code></a>&nbsp;for force coefficients only from a file:</p>
<blockquote>
<div><div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">referenceArea</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">;</span> <span class="c1">// Define reference area</span>

<span class="c1">// Define physical meaning of independent variables, in this case Mach number and angle of attack</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">AerodynamicCoefficientsIndependentVariables</span> <span class="o">&gt;</span> <span class="n">independentVariableNames</span><span class="p">;</span>
<span class="n">independentVariableNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">mach_number_dependent</span> <span class="p">);</span>
<span class="n">independentVariableNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">angle_of_attack_dependent</span> <span class="p">);</span>

<span class="c1">// Define list of files for force coefficients. Entry 0 denotes the x-direction (C ~D~/C ~X~), 1 the y-direction (C ~S~/C ~Y~) and 2 the z-direction (C ~L~/C ~Z~)</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&gt;</span> <span class="n">forceCoefficientFiles</span><span class="p">;</span>
<span class="n">forceCoefficientFiles</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tudat</span><span class="o">::</span><span class="n">input_output</span><span class="o">::</span><span class="n">getTudatRootPath</span><span class="p">(</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&quot;Astrodynamics/Aerodynamics/UnitTests/aurora_CD.txt&quot;</span><span class="p">;</span> <span class="c1">// Set drag coefficient file</span>
<span class="n">forceCoefficientFiles</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tudat</span><span class="o">::</span><span class="n">input_output</span><span class="o">::</span><span class="n">getTudatRootPath</span><span class="p">(</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&quot;Astrodynamics/Aerodynamics/UnitTests/aurora_CL.txt&quot;</span><span class="p">;</span> <span class="c1">// Set lift coefficient file</span>

<span class="c1">// Define reference frame in which the loaded coefficients are defined.</span>
<span class="kt">bool</span> <span class="n">areCoefficientsInAerodynamicFrame</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">areCoefficientsInNegativeAxisDirection</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="c1">// Load and parse files; create coefficient settings.</span>
<span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">AerodynamicCoefficientSettings</span> <span class="o">&gt;</span> <span class="n">aerodynamicCoefficientSettings</span> <span class="o">=</span>
    <span class="n">readTabulatedAerodynamicCoefficientsFromFiles</span><span class="p">(</span> <span class="n">forceCoefficientFiles</span><span class="p">,</span> <span class="n">referenceArea</span><span class="p">,</span> <span class="n">independentVariableNames</span><span class="p">,</span> <span class="n">areCoefficientsInAerodynamicFrame</span><span class="p">,</span>         <span class="n">areCoefficientsInNegativeAxisDirection</span> <span class="p">);</span>

<span class="c1">// Create and set aerodynamic coefficients</span>
<span class="n">bodyMap</span><span class="p">[</span> <span class="s">&quot;VehicleName&quot;</span> <span class="p">]</span><span class="o">-&gt;</span><span class="n">setAerodynamicCoefficientInterface</span><span class="p">(</span>
                    <span class="n">createAerodynamicCoefficientInterface</span><span class="p">(</span> <span class="n">aerodynamicCoefficientSettings</span><span class="p">,</span> <span class="s">&quot;VehicleName&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>Note that in the above, no side force coefficient file (entry 1 for forceCoefficientFiles) is given, so that C:sub:<a href="#id1"><span class="problematic" id="id2">`</span></a>S`=0 always. Two independent variables have been defines (Mach number and angle of attack). If either the lift or drag coefficient files encounter a different number of independent variables, the program will terminate with an appropriate error message. Also, if the independent variables used for the lift and drag coefficients are not identical, the program is terminated.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Moment coefficients are added in a completely analogous manner (with separate files for the x-, y- and z-components).</p>
</div>
</div>
<div class="section" id="adding-control-surface-influence">
<h3>4.2.3.2. Adding control surface influence<a class="headerlink" href="#adding-control-surface-influence" title="Permalink to this headline">¶</a></h3>
<p>In addition to defining aerodynamic coefficients for the vehicle itself, the influence of control surface deflections on the values of the coefficients will be needed for certain applications. In Tudat, any number of control surfaces may be defined for a vehicle, the deflection of which may be set by your particular <a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal"><span class="pre">AerodynamicGuidance</span></code></a> derived class. Loading the aerodynamic coefficient increments of the control surface is done in a manner similar to those of the total vehicle, but:</p>
<blockquote>
<div><ul class="simple">
<li>Reference area and reference frame in which the coefficients are defined are not provided. These are implcitily assumed to be equal to those of the aerodynamic coefficients of the ‘main body’. If your application requires these quantities to be different for the body and control surface deflections, please open an issue on Github requesting the functionality.</li>
<li>Exactly one of the independent variables of the coefficient increments must be a control surface deflection.</li>
</ul>
</div></blockquote>
<p>Below, an example is given on how to load the aerodynamic coefficient increments:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="c1">// Create coefficient settings for body.</span>
<span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">AerodynamicCoefficientSettings</span> <span class="o">&gt;</span> <span class="n">aerodynamicCoefficientSettings</span> <span class="o">=</span> <span class="p">...</span>

<span class="c1">// Define physical meaning of independent variables for control surface increments, in this case Mach number, angle of attack and control surface deflection</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">AerodynamicCoefficientsIndependentVariables</span> <span class="o">&gt;</span> <span class="n">controlSurfaceIndependentVariableNames</span><span class="p">;</span>
<span class="n">controlSurfaceIndependentVariableNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">mach_number_dependent</span> <span class="p">);</span>
<span class="n">controlSurfaceIndependentVariableNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">angle_of_attack_dependent</span> <span class="p">);</span>
<span class="n">controlSurfaceIndependentVariableNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">control_surface_deflection_dependent</span> <span class="p">);</span>

<span class="c1">// Define name of control surface</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">controlSurfaceName</span> <span class="o">=</span> <span class="s">&quot;Elevon&quot;</span><span class="p">;</span>

<span class="c1">// Define list of files for force coefficients.</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&gt;</span> <span class="n">controlSurfaceForceCoefficientFiles</span><span class="p">;</span>
<span class="n">controlSurfaceForceCoefficientFiles</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tudat</span><span class="o">::</span><span class="n">input_output</span><span class="o">::</span><span class="n">getTudatRootPath</span><span class="p">(</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&quot;Astrodynamics/Aerodynamics/UnitTests/dCDwTest.txt&quot;</span><span class="p">;</span> <span class="c1">// Set drag coefficient file</span>

<span class="c1">// Add settings for control surface increments to main aerodynamic coefficients</span>
<span class="n">aerodynamicCoefficientSettings</span><span class="o">-&gt;</span><span class="n">setControlSurfaceSettings</span><span class="p">(</span>
    <span class="n">readTabulatedControlIncrementAerodynamicCoefficientsFromFiles</span><span class="p">(</span> <span class="n">controlSurfaceForceCoefficientFiles</span><span class="p">,</span> <span class="n">controlSurfaceIndependentVariableNames</span><span class="p">,</span> <span class="n">controlSurfaceName</span> <span class="p">)</span> <span class="p">);</span>

<span class="c1">// Create and set aerodynamic coefficients</span>
<span class="n">bodyMap</span><span class="p">[</span> <span class="s">&quot;VehicleName&quot;</span> <span class="p">]</span><span class="o">-&gt;</span><span class="n">setAerodynamicCoefficientInterface</span><span class="p">(</span>
    <span class="n">createAerodynamicCoefficientInterface</span><span class="p">(</span> <span class="n">aerodynamicCoefficientSettings</span><span class="p">,</span> <span class="s">&quot;VehicleName&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>For this example, only the drag coefficient is affected by the control surface deflections.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="thrustModels.html" class="btn btn-neutral float-right" title="4.3. Thrust Guidance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="frameworkAcceleration.html" class="btn btn-neutral" title="4.1. Implementation Framework of the Acceleration Settings" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });
    });
</script>


</body>
</html>